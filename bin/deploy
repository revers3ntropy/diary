#!/bin/bash

start=`date +%s`

die () {
    echo >&2 "$@"
    exit 1
}

[ "$#" -eq 1 ] || die "1 argument required, $# provided"

[ -d "./secrets/$1" ] || die "Error: Directory /secrets/$1 does not exists."

mv .env tmp.env
mv "./secrets/$1/remote.env" .env

bin/build || die "build failed";

mv .env "./secrets/$1/remote.env"
mv tmp.env .env

[ -d "build" ] || die "output dir not found"

node --enable-source-maps bin/upload -v --env "$1"

end=`date +%s`

runtime=$( echo "$end - $start" | bc -l )

echo "Deployment total time: $runtime s"

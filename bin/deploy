#!/bin/bash

start=`date +%s`

die () {
    echo >&2 "$@"
    exit 1
}

[ "$#" -eq 1 ] || die "1 argument required, $# provided"

mv .env tmp.env
mv "$1.remote.env" .env

bin/build;

mv .env "$1.remote.env"
mv tmp.env .env

[ -d "build" ] || die "output dir not found"

node --enable-source-maps bin/upload -v --env "$1"

end=`date +%s`

runtime=$( echo "$end - $start" | bc -l )

echo "Deployment total time: $runtime s"
